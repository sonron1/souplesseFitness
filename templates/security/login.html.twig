{% extends 'base.html.twig' %}

{% block title %}Connexion - Souplesse Fitness{% endblock %}

{% block meta_description %}Connectez-vous à votre espace membre Souplesse Fitness pour accéder à vos réservations, votre suivi et bien plus encore.{% endblock %}

{% block body_class %}login-page{% endblock %}

{% block body %}
    <!-- Header spécifique à la page de connexion -->
    <header class="bg-figma-yellow py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6 text-center">
                    <h1 class="display-5 fw-bold text-figma-dark mb-3">
                        <i class="bi bi-person-circle me-2"></i>Connexion
                    </h1>
                    <p class="lead text-figma-dark mb-0">
                        Accédez à votre espace membre et continuez votre parcours fitness
                    </p>
                </div>
            </div>
        </div>
    </header>

    <!-- Formulaire de connexion -->
    <main class="py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-5">
                    {% if app.user %}
                        <!-- Utilisateur déjà connecté -->
                        <div class="card border-0 shadow-sm mb-4" style="border-radius: 1.4rem;">
                            <div class="card-body p-4 text-center">
                                <i class="bi bi-check-circle-fill text-success display-6 mb-3"></i>
                                <h3 class="fw-bold text-figma-dark mb-3">Déjà connecté</h3>
                                <p class="text-figma-dark mb-4">
                                    Vous êtes connecté en tant que <strong>{{ app.user.userIdentifier }}</strong>
                                </p>
                                <div class="d-grid gap-2">
                                    <a href="#" class="btn btn-figma-yellow rounded-pill py-2 fw-bold">
                                        <i class="bi bi-speedometer2 me-1"></i> Accéder au dashboard
                                    </a>
                                    <a href="{{ path('app_logout') }}" class="btn btn-figma-outline-dark rounded-pill py-2">
                                        <i class="bi bi-box-arrow-right me-1"></i> Se déconnecter
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <!-- Formulaire de connexion -->
                        <div class="card border-0 shadow-sm" style="border-radius: 1.4rem;">
                            <div class="card-body p-4 p-md-5">
                                {% if error %}
                                    <div class="alert alert-danger mb-4" role="alert">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        <strong>Erreur de connexion :</strong> {{ error.messageKey|trans(error.messageData, 'security') }}
                                    </div>
                                {% endif %}

                                <form method="post">
                                    <!-- Email -->
                                    <div class="mb-3">
                                        <label for="inputEmail" class="form-label fw-medium text-figma-dark">
                                            <i class="bi bi-envelope me-1"></i> Adresse email
                                        </label>
                                        <input type="email"
                                               value="{{ last_username }}"
                                               name="_username"
                                               id="inputEmail"
                                               class="form-control form-control-lg"
                                               autocomplete="email"
                                               required
                                               autofocus
                                               placeholder="votre@email.com">
                                    </div>

                                    <!-- Mot de passe -->
                                    <div class="mb-3">
                                        <label for="inputPassword" class="form-label fw-medium text-figma-dark">
                                            <i class="bi bi-lock me-1"></i> Mot de passe
                                        </label>
                                        <div class="input-group">
                                            <input type="password"
                                                   name="_password"
                                                   id="inputPassword"
                                                   class="form-control form-control-lg"
                                                   autocomplete="current-password"
                                                   required
                                                   placeholder="••••••••">
                                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                                <i class="bi bi-eye" id="toggleIcon"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Se souvenir de moi -->
                                    <div class="mb-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="_remember_me" id="remember_me">
                                            <label class="form-check-label text-figma-dark" for="remember_me">
                                                Se souvenir de moi
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Token CSRF -->
                                    <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

                                    <!-- Bouton de connexion -->
                                    <div class="d-grid mb-4">
                                        <button class="btn btn-figma-yellow btn-lg rounded-pill py-3 fw-bold" type="submit">
                                            <i class="bi bi-box-arrow-in-right me-2"></i>Se connecter
                                        </button>
                                    </div>

                                    <!-- Liens utiles -->
                                    <div class="text-center">
                                        <p class="text-figma-dark mb-2">
                                            <a href="#" class="text-figma-dark text-decoration-underline">Mot de passe oublié ?</a>
                                        </p>
                                        <p class="text-figma-dark">
                                            Pas encore membre ?
                                            <a href="{{ path('app_register') }}" class="text-figma-yellow text-decoration-underline fw-bold">
                                                Créer un compte
                                            </a>
                                        </p>
                                    </div>
                                </form>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>

    <!-- AVANTAGES MEMBRES -->
    <section class="bg-light py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 text-center">
                    <h2 class="fw-bold text-figma-dark mb-4">
                        <i class="bi bi-star-fill text-figma-yellow me-2"></i>Avantages membres
                    </h2>
                    <div class="row g-4">
                        <div class="col-md-4">
                            <div class="d-flex flex-column align-items-center">
                                <i class="bi bi-calendar2-check display-6 text-figma-yellow mb-2"></i>
                                <h5 class="fw-bold text-figma-dark">Réservation en ligne</h5>
                                <p class="text-figma-dark small">Réservez vos cours et créneaux facilement</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex flex-column align-items-center">
                                <i class="bi bi-graph-up display-6 text-figma-yellow mb-2"></i>
                                <h5 class="fw-bold text-figma-dark">Suivi des progrès</h5>
                                <p class="text-figma-dark small">Visualisez votre évolution</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="d-flex flex-column align-items-center">
                                <i class="bi bi-chat-dots display-6 text-figma-yellow mb-2"></i>
                                <h5 class="fw-bold text-figma-dark">Coaching personnalisé</h5>
                                <p class="text-figma-dark small">Échangez avec nos coachs</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion de l'affichage/masquage du mot de passe
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('inputPassword');
        const toggleIcon = document.getElementById('toggleIcon');

        if (togglePassword && passwordInput && toggleIcon) {
            togglePassword.addEventListener('click', function() {
                // Basculer le type d'input entre 'password' et 'text'
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);

                // Changer l'icône
                if (type === 'text') {
                    toggleIcon.classList.remove('bi-eye');
                    toggleIcon.classList.add('bi-eye-slash');
                    togglePassword.title = 'Masquer le mot de passe';
                    togglePassword.setAttribute('aria-label', 'Masquer le mot de passe');
                } else {
                    toggleIcon.classList.remove('bi-eye-slash');
                    toggleIcon.classList.add('bi-eye');
                    togglePassword.title = 'Afficher le mot de passe';
                    togglePassword.setAttribute('aria-label', 'Afficher le mot de passe');
                }
            });

            // Ajouter les attributs d'accessibilité
            togglePassword.title = 'Afficher le mot de passe';
            togglePassword.setAttribute('aria-label', 'Afficher le mot de passe');
        }
    });
</script>
{% endblock %}

